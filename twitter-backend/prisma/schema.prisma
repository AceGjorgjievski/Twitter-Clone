// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int      @id @default(autoincrement())
  name           String   @unique
  slug           String   @unique
  email          String   @unique
  password       String
  role           String   @default("user")
  profilePicture String?
  createdAt      DateTime @default(now())

  tweets      Tweet[] @relation("AuthorTweet")
  likedTweets Tweet[] @relation("LikedTweets")

  following UserFollow[] @relation("Following")
  followers UserFollow[] @relation("Followers")

  @@map("users")
}

model UserFollow {
  followerId Int
  followingId Int

  follower  User @relation("Following", fields: [followerId], references: [id])
  following User @relation("Followers", fields: [followingId], references: [id])

  @@id([followerId, followingId])
  @@map("user_follows")
}


model Tweet {
  id          Int      @id @default(autoincrement())
  description String?  @db.VarChar(280)
  images      String[]
  createdAt   DateTime @default(now())

  authorId Int?
  author   User? @relation("AuthorTweet", fields: [authorId], references: [id])

  likedBy    User[] @relation("LikedTweets")
  totalLikes Int    @default(0)

  retweetOfId Int?
  retweetOf   Tweet?  @relation("RetweetRelation", fields: [retweetOfId], references: [id])
  retweets    Tweet[] @relation("RetweetRelation")

  retweetCount Int @default(0)

  comments Comment[]

  @@index([createdAt])
  @@index([retweetOfId])
}

model Comment {
  id          Int    @id @default(autoincrement())
  author_id   Int
  description String @db.VarChar(280)
  tweetId     Int
  tweet       Tweet  @relation(fields: [tweetId], references: [id])
}
